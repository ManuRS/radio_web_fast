<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>P√≥dcast de boletos</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { text-align: center; }
    .podcast { 
      margin-bottom: 50px;
      padding-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    .podcast-contenido {
      display: flex;
      align-items: center; /* centra verticalmente la imagen con el contenido */
      gap: 40px; /* espacio entre imagen y contenido */
    }
    .podcast-texto { flex: 1; }
    .podcast img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
    }
    audio { width: 100%; margin-top: 10px; display: block; }
    .titulo-principal { font-weight: bold; margin: 0; }
    .titulo-secundario { color: gray; font-style: italic; margin: 2px 0 0 0; }
    .controles {
      margin-top: 5px;
    }
    .controles button {
      margin-right: 10px;
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #f0f0f0;
      cursor: pointer;
    }
    .controles button:hover { background: #ddd; }

    /* üì± M√≥viles */
    @media (max-width: 600px) {
      body { padding: 10px; }

      .podcast-contenido {
        flex-direction: column; /* Imagen arriba, texto abajo */
        gap: 10px;              /* menos espacio entre imagen y texto */
        align-items: center;    /* centra todo horizontalmente */
        text-align: center;     /* centra el texto */
      }

      .podcast img {
        width: 100px;
        height: 100px;
        margin: 0 auto;        /* centrada horizontalmente */
      }
      
      .podcast-texto {
        width: 100%;            /* ocupa todo el ancho disponible */
      }
      
      .titulo-principal {
        text-align: center;     /* t√≠tulo centrado */
      }

      audio {
        width: 100%;            /* reproductor sin m√°rgenes */
      }
      
      .controles {
        display: flex;
        gap: 5px;            /* espacio entre botones */
        margin-top: 20px;
        width: 100%;
        justify-content: space-between;
      }

      .controles button {
        flex: 1;             /* cada bot√≥n ocupa el mismo ancho */
        margin: 5;
        padding: 10px 0;      /* altura del bot√≥n */
        box-sizing: border-box;
      }

    }

    /* üíª Escritorio grande */
    @media (min-width: 601px) {
      .podcast-contenido {
        gap: 40px;
      }
    }

    /* Modal oculto por defecto */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    /* Caja del modal */
    .modal-content {
      background: #fff;
      color: #333;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      width: 80%;
      max-width: 300px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      animation: fadeIn 0.3s ease;
    }

    .modal-content p {
      margin-bottom: 15px;
      font-size: 1rem;
    }

    .buttons {
      display: flex;
      justify-content: space-around;
      gap: 10px;
    }

    .modal-content button {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    #stay-btn {
      background: #1a237e;
      color: #fff;
    }

    #exit-btn {
      background: #ff1744;
      color: #fff;
    }

  </style>
</head>
<body>
  <h1>P√≥dcast de boletos<br><br></h1>
  <div id="lista"></div>

  <!-- Modal salir -->
  <div id="exit-modal" class="modal">
    <div class="modal-content">
      <p><b>Pulsa atr√°s / desliza de nuevo para salir</b></p>
      <div class="buttons">
        <button id="stay-btn">Seguir en la p√°gina</button>
      </div>
    </div>
  </div>

  <script>
    const feedUrl = "https://fapi-top.prisasd.com/podcast/playser/boletines/itunestfp/podcast.xml"; // Sustituye con tu RSS

    async function cargarRSS() {
      try {
        const res = await fetch(feedUrl);
        const texto = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(texto, "application/xml");

        const items = Array.from(xml.querySelectorAll("item")).slice(0, 30); // √∫ltimos 30

        const imageUrl = xml.querySelector("image > url")?.textContent || null;
        const htmlImagen = imageUrl ? `<img src="${imageUrl}" alt="Podcast">` : "";

        const listaDiv = document.getElementById("lista");

        items.forEach(item => {
          const titulo = item.querySelector("title")?.textContent || "Sin t√≠tulo";
          const pubDate = item.querySelector("pubDate")?.textContent || null;
          const audioUrl = item.querySelector("enclosure")?.getAttribute("url") || null;

          const contenedor = document.createElement("div");
          contenedor.className = "podcast";

          if (audioUrl) {
            contenedor.innerHTML = `
              <div class="podcast-contenido">
                ${htmlImagen}
                <div class="podcast-texto">
                  <p class="titulo-principal">${titulo}</p>
                  <br>
                  <audio controls style="background-color: #f1f3f4;" src="${audioUrl}"></audio>
                  <div class="controles">
                    <br>
                    <button onclick="
                      let a=this.parentElement.previousElementSibling;
                      if(a.paused){ a.play(); this.textContent='‚è∏ Pausa'; }
                      else { a.pause(); this.textContent='‚ñ∂ Play'; }
                  ">‚ñ∂ Play</button>
                    <button onclick="this.parentElement.previousElementSibling.currentTime = Math.max(0,this.parentElement.previousElementSibling.currentTime-10)">‚è™ -10s</button>
                    <button onclick="this.parentElement.previousElementSibling.currentTime = Math.min(this.parentElement.previousElementSibling.duration,this.parentElement.previousElementSibling.currentTime+10)">‚è© +10s</button>
                    <button onclick="let a=this.parentElement.previousElementSibling;a.playbackRate=a.playbackRate===1?2:1;this.textContent=a.playbackRate===2?'‚è∏ x1':'‚è© x2'">‚è© x2</button>
                  </div>
                </div>
              </div>
              <br>
            `;
          } else {
            contenedor.innerHTML = `<p class="titulo-principal">${titulo} (No se encontr√≥ audio)</p>`;
          }

          listaDiv.appendChild(contenedor);
        });

      } catch(e) {
        console.error("Error cargando RSS:", e);
      }
    }

    cargarRSS();

    // Referencias al modal y botones
    const exitModal = document.getElementById("exit-modal");
    const stayBtn = document.getElementById("stay-btn");

    // Interceptar bot√≥n atr√°s
    window.addEventListener("load", () => {
      history.pushState(null, "", location.href);

      window.addEventListener("popstate", () => {
        // Mostrar modal en vez de cerrar
        exitModal.style.display = "flex";
        history.pushState(null, "", location.href); // volvemos a bloquear
      });
    });

    // Bot√≥n "Seguir escuchando"
    stayBtn.addEventListener("click", () => {
      exitModal.style.display = "none";
    });

  </script>
</body>
</html>
