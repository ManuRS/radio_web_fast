<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>P√≥dcast en l√≠nea</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { text-align: center; }
    .podcast { 
      margin-bottom: 50px;
      padding-bottom: 20px;
      border-bottom: 1px solid #ddd;
    }
    .podcast-contenido {
      display: flex;
      align-items: center; /* centra verticalmente la imagen con el contenido */
      gap: 40px; /* espacio entre imagen y contenido */
    }
    .podcast-texto { flex: 1; }
    .podcast img {
      width: 120px;
      height: 120px;
      object-fit: cover;
      border-radius: 5px;
    }
    audio { width: 100%; margin-top: 10px; display: block; }
    .titulo-principal { font-weight: bold; margin: 0; }
    .titulo-secundario { color: gray; font-style: italic; margin: 2px 0 0 0; }
    .controles {
      margin-top: 5px;
    }
    .controles button {
      margin-right: 10px;
      padding: 5px 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: #f0f0f0;
      cursor: pointer;
    }
    .controles button:hover { background: #ddd; }

    /* üì± M√≥viles */
    @media (max-width: 600px) {
      body { padding: 10px; }

      .podcast-contenido {
        flex-direction: column; /* Imagen arriba, texto abajo */
        gap: 10px;              /* menos espacio entre imagen y texto */
        align-items: center;    /* centra todo horizontalmente */
        text-align: center;     /* centra el texto */
      }

      .podcast img {
        width: 100px;
        height: 100px;
        margin: 0 auto;        /* centrada horizontalmente */
      }
      
      .podcast-texto {
        width: 100%;            /* ocupa todo el ancho disponible */
      }
      
      .titulo-principal {
        text-align: center;     /* t√≠tulo centrado */
      }

      audio {
        width: 100%;            /* reproductor sin m√°rgenes */
      }
      
      .controles {
        display: flex;
        flex-wrap: wrap;
        justify-content: center; /* botones centrados */
        gap: 5px;
        margin-top: 30px;    
      }

      .controles button {
        margin: 0;
      }

    }

    /* üíª Escritorio grande */
    @media (min-width: 601px) {
      .podcast-contenido {
        gap: 40px;
      }
    }

  </style>
</head>
<body>
  <h1>P√≥dcast en l√≠nea<br><br></h1>
  <div id="lista"></div>

  <script>
    const podcasts = [

      { nombre: "Bolet√≠n RNE", url: "https://api.rtve.es/api/adapter/programas/1750/audios.rss", capitulo: ["00H"] },
      { nombre: "Bolet√≠n COPE", url: "https://www.cope.es/api/es/audios/boletin/reciente/rss.xml", capitulo: ["BOLET√çN"] },
      { nombre: "Bolet√≠n Onda Cero", url: "https://www.ondacero.es/rss/podcast/2092986/podcast.xml", capitulo: ["Las noticias de Onda Cero"] },

      { nombre: "RNE 14 Horas", url: "https://api.rtve.es/api/adapter/programas/1931/audios.rss", capitulo: ["14 horas - "] },
      { nombre: "Mediod√≠a COPE", url: "https://www.cope.es/api/es/programas/mediodia-cope/audios/rss.xml", capitulo: ["14:00H"] },
      { nombre: "Noticias Mediod√≠a Onda Cero", url: "https://www.ondacero.es/rss/podcast/8321/podcast.xml", capitulo: ["Noticias mediod√≠a "] },
    ];

    function tiempoDesde(publicacion) {
      const ahora = new Date();
      const pubDate = new Date(publicacion);
      const diffMs = ahora - pubDate;
      const diffSeg = Math.floor(diffMs / 1000);

      if (diffSeg < 60) return `Antiguedad ${diffSeg} segundos`;
      const diffMin = Math.floor(diffSeg / 60);
      if (diffMin < 60) return `Antiguedad ${diffMin} minutos`;
      const diffHoras = Math.floor(diffMin / 60);
      if (diffHoras < 24) return `Antiguedad ${diffHoras} horas`;
      const diffDias = Math.floor(diffHoras / 24);
      return `Antiguedad ${diffDias} d√≠as`;
    }

    function formatearFecha(fechaStr) {
      const date = new Date(fechaStr);
      const dia = String(date.getDate()).padStart(2, '0');
      const mes = String(date.getMonth() + 1).padStart(2, '0');
      const anio = date.getFullYear();
      return `${dia}/${mes}/${anio}`;
    }

    const listaDiv = document.getElementById("lista");
    const contenedores = podcasts.map(() => {
      const div = document.createElement("div");
      div.className = "podcast";
      listaDiv.appendChild(div);
      return div;
    });

    podcasts.forEach((p, index) => cargarRSS(p, contenedores[index]));

    async function cargarRSS(p, contenedor) {
      try {
        const res = await fetch(p.url);
        const texto = await res.text();
        const parser = new DOMParser();
        const xml = parser.parseFromString(texto, "application/xml");

        const items = xml.querySelectorAll("item");
        let audioUrl = null;
        let tituloEncontrado = null;
        let pubDateEncontrado = null;

        imageUrlElement = null;
        imageUrl = null;
        htmlImagen = null;

        for (const item of items) {
          const titulo = item.querySelector("title")?.textContent || "";
          if (p.capitulo.some(c => titulo.includes(c))) {
            tituloEncontrado = titulo;
            pubDateEncontrado = item.querySelector("pubDate")?.textContent || null;
            const enclosure = item.querySelector("enclosure");
            if (enclosure) audioUrl = enclosure.getAttribute("url");

            //imageUrlElement = item.getElementsByTagName('itunes:image')[0];
            //imageUrl = imageUrlElement ? imageUrlElement.getAttribute('href') : null;
            //htmlImagen = imageUrl ? `<img src="${imageUrl}" alt="${p.nombre}">` : "";

            break;
          }
        }

        //imageUrl = xml.querySelector("image > url")?.textContent || null;
        //htmlImagen = imageUrl ? `<img src="${imageUrl}" alt="${p.nombre}">` : "";

        imageUrlElement = xml.getElementsByTagName('itunes:image')[0];
        imageUrl = imageUrlElement ? imageUrlElement.getAttribute('href') : null;
        htmlImagen = imageUrl ? `<img src="${imageUrl}" alt="${p.nombre}">` : "";

        if (audioUrl) {
          const tiempo = pubDateEncontrado ? tiempoDesde(pubDateEncontrado) : "";
          const fechaFormateada = pubDateEncontrado ? formatearFecha(pubDateEncontrado) : "";

          contenedor.innerHTML = `
            <div class="podcast-contenido">
              ${htmlImagen}
              <div class="podcast-texto">
                <p class="titulo-principal" style="display:inline">${p.nombre} / ${tiempo}</p><br><br>
                <p class="titulo-secundario" style="display:inline">(${tituloEncontrado})</p>
                <br><br>
                <audio controls style="background-color: #f1f3f4;" src="${audioUrl}"></audio>
                <div class="controles">
                  <br>
                  <button onclick="
                      let a=this.parentElement.previousElementSibling;
                      if(a.paused){ a.play(); this.textContent='‚è∏ Pausa'; }
                      else { a.pause(); this.textContent='‚ñ∂ Play'; }
                  ">‚ñ∂ Play</button>
                  <button onclick="this.parentElement.previousElementSibling.currentTime = Math.max(0,this.parentElement.previousElementSibling.currentTime-10)">‚è™ -10s</button>
                  <button onclick="this.parentElement.previousElementSibling.currentTime = Math.min(this.parentElement.previousElementSibling.duration,this.parentElement.previousElementSibling.currentTime+10)">‚è© +10s</button>
                  <button onclick="let a=this.parentElement.previousElementSibling;a.playbackRate=a.playbackRate===1?2:1;this.textContent=a.playbackRate===2?'‚è∏ x1':'‚è© x2'">‚è© x2</button>
                </div>
              </div>
            </div>
          `;

          contenedor.innerHTML = contenedor.innerHTML + '<br>'

        } else {
          contenedor.innerHTML = `<p class="titulo-principal">${p.nombre} (No se encontr√≥ el cap√≠tulo "${p.capitulo}")</p>`;
        }

      } catch (e) {
        console.error("Error cargando RSS:", e);
      }
    }
  </script>
</body>
</html>
