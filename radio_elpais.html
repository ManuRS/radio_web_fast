<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Portada de El País</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 { text-align: center; }

    /* Grid + aire lateral en tamaños grandes */
    .rss-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-top: 20px;
      max-width: 1200px;    /* aire en lados */
      margin-left: auto;
      margin-right: auto;
      padding: 0 20px;      /* un poco más de aire interno */
    }

    .rss-item {
      background: #fff;
      border-radius: 12px;
      overflow: hidden; /* para que la imagen respete el borde redondeado */
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }
    .rss-item img {
      width: 100%;
      height: 160px;
      object-fit: cover;
      display: block;
    }
    .rss-content {
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      flex: 1;
    }
    .rss-item h2 {
      font-size: 18px;
      margin: 0;
      line-height: 1.25;
    }
    .rss-item h2 a {
      text-decoration: none;
      color: #0077cc;
    }
    .rss-item h2 a:hover { text-decoration: underline; }

    .rss-item p {
      font-size: 14px;
      color: #444;
      margin: 0;
      flex: 1;
    }
    .rss-date {
      font-size: 12px;
      color: #666;
      font-style: italic; /* fecha en cursiva */
      margin-top: 6px;
    }
  </style>
</head>
<body>
  <h1>Portada de El País</h1>
  <div class="rss-container" id="rss" aria-live="polite"></div>

  <script>
    const FEED_URL = "https://feeds.elpais.com/mrss-s/pages/ep/site/elpais.com/portada";
    const MAX_ITEMS = 12;
    const MAX_CHARS = 250;

    const truncate = (str = "", n = MAX_CHARS) =>
      str.length > n ? str.slice(0, n - 3).trimEnd() + "..." : str;

    const stripHTML = (html = "") => {
      const tmp = document.createElement("div");
      tmp.innerHTML = html;
      return (tmp.textContent || tmp.innerText || "").trim();
    };

    const formatDateES = (dateStr = "") => {
      const d = new Date(dateStr);
      if (isNaN(d)) return "";
      return d.toLocaleString("es-ES", {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        timeZone: "Europe/Madrid"
      });
    };

    /** Devuelve URL de imagen priorizando <media:thumbnail>. Si no hay, cae a url de <media:content>. */
    const getMediaImageUrl = (item) => {
      // 1) Buscar cualquier <media:content>
      const mediaContents = item.getElementsByTagName("media:content");
      if (!mediaContents || !mediaContents.length) return null;

      // 1.a) Priorizar <media:thumbnail> dentro de algún <media:content>
      for (const mc of mediaContents) {
        const thumbs = mc.getElementsByTagName("media:thumbnail");
        if (thumbs && thumbs.length) {
          const thumbUrl = thumbs[0].getAttribute("url");
          if (thumbUrl) return thumbUrl;
        }
      }

      // 2) Fallback: url del primer <media:content> (como pediste)
      //    Puede que sea vídeo; si rompe, el onerror del <img> la ocultará.
      const first = mediaContents[0];
      const url = first.getAttribute("url");
      if (url) return url;

      return null;
    };

    async function loadRSS() {
      try {
        const res = await fetch(FEED_URL);
        const xmlText = await res.text();

        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "application/xml");

        const items = xml.querySelectorAll("item");
        const container = document.getElementById("rss");
        container.innerHTML = "";

        items.forEach((item, idx) => {
          if (idx >= MAX_ITEMS) return;

          let title = item.querySelector("title")?.textContent || "";
          let description = item.querySelector("description")?.textContent || "";
          const link = item.querySelector("link")?.textContent || "#";
          const pubDate = item.querySelector("pubDate")?.textContent || "";

          // Sanitizar y recortar
          title = truncate(stripHTML(title));
          description = truncate(stripHTML(description));

          const fecha = formatDateES(pubDate);
          const imgUrl = getMediaImageUrl(item);

          const card = document.createElement("div");
          card.className = "rss-item";

          card.innerHTML = `
            ${imgUrl ? `<img src="${imgUrl}" alt="${title.replace(/"/g, '&quot;')}" onerror="this.style.display='none'">` : ""}
            <div class="rss-content">
              <h2><a href="${link}" target="_blank" rel="noopener noreferrer">${title}</a></h2>
              <p>${description}</p>
              <div class="rss-date">${fecha}</div>
            </div>
          `;

          container.appendChild(card);
        });
      } catch (e) {
        console.error("Error al cargar el feed:", e);
        document.getElementById("rss").innerHTML = "<p>No se pudieron cargar las noticias.</p>";
      }
    }

    loadRSS();
  </script>
</body>
</html>
